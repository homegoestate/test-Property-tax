<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®åœ‹åœ°æ”¿ï½œæ˜“ä¸åœ°æ”¿ - èˆŠåˆ¶è²¡ç”¢äº¤æ˜“æ‰€å¾—ç¨…ç²¾ç®— V21.6</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <script>
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.onkeydown = function(e) {
            if(e.keyCode == 123) return false; // F12
            if(e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) return false; // Ctrl+Shift+I
            if(e.ctrlKey && e.shiftKey && e.keyCode == 'C'.charCodeAt(0)) return false; // Ctrl+Shift+C
            if(e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) return false; // Ctrl+Shift+J
            if(e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) return false; // Ctrl+U
            if(e.ctrlKey && e.keyCode == 'S'.charCodeAt(0)) return false; // Ctrl+S (å­˜æª”)
        }
    </script>
    <style>
        :root {
            --primary: #1A3C5C; /* å®åœ‹æ·±è— */
            --gold: #C5A065;    /* è³ªæ„Ÿé‡‘ */
            --light: #F4F7F6;
            --white: #FFFFFF;
            --text: #333333;
            --border: #D1D5DB;
            --accent-red: #D32F2F;
            --line-green: #06C755;
            --fb-blue: #1877F2;
        }

        /* å¢åŠ  user-select: none é˜²æ­¢æ–‡å­—è¢«è¼•æ˜“é¸å–è¤‡è£½ï¼Œä½†åœ¨è¼¸å…¥æ¡†ä¸­å…è¨± */
        * { box-sizing: border-box; outline: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
        input, select, textarea { -webkit-user-select: auto; -moz-user-select: auto; -ms-user-select: auto; user-select: auto; }

        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background: var(--light); 
            color: var(--text); 
            margin: 0; 
            padding: 20px 20px 120px 20px; /* åº•éƒ¨ç•™ç™½çµ¦æŒ‰éˆ• */
            line-height: 1.6;
            position: relative;
            min-height: 100vh;
        }

        /* --- æµ®æ°´å° (ç½®é ‚) --- */
        .watermark-container {
            position: fixed;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 600px;
            z-index: 0;
            pointer-events: none;
            opacity: 0.08;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }
        .watermark-container img { width: 45%; height: auto; object-fit: contain; }

        /* --- Header --- */
        .header { text-align: center; margin-bottom: 20px; background: var(--white); padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-top: 5px solid var(--gold); position: relative; z-index: 1; }
        .logo-group { display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 15px; }
        .logo-group img { height: 60px; object-fit: contain; }
        .header h1 { font-size: 1.6rem; color: var(--primary); margin: 5px 0; font-weight: 800; }
        .header .subtitle { color: #666; font-size: 1rem; }

        /* --- Layout --- */
        .container { max-width: 900px; margin: 0 auto; position: relative; z-index: 1; }

        /* --- Tabs --- */
        .tab-group { display: flex; margin-bottom: 20px; background: #E0E0E0; border-radius: 8px; padding: 4px; }
        .tab { flex: 1; text-align: center; padding: 12px; cursor: pointer; border-radius: 6px; font-weight: bold; color: #666; transition: 0.3s; font-size: 0.95rem; }
        .tab.active { background: var(--primary); color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* --- Cards --- */
        .card { background: var(--white); padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; display: none; }
        .card.active { display: block; animation: fadeIn 0.4s; }
        .card-header { font-size: 1.1rem; font-weight: 700; color: var(--primary); border-bottom: 2px solid #F0F0F0; padding-bottom: 10px; margin-bottom: 20px; }

        /* --- Inputs --- */
        .input-group { margin-bottom: 15px; }
        .label { display: block; font-size: 0.9rem; font-weight: 600; color: #555; margin-bottom: 5px; }
        .input-row { display: flex; gap: 10px; align-items: flex-end; }
        .input-col { flex: 1; }
        
        input, select { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 1rem; text-align: right; background: #FAFAFA; }
        select { text-align: left; }
        input:focus, select:focus { border-color: var(--primary); background: #FFF; box-shadow: 0 0 0 3px rgba(26, 60, 92, 0.1); }
        .input-readonly { background: #EEE; color: #777; cursor: default; }

        /* --- Helper --- */
        .helper-box { background: #FFF8E1; border: 1px dashed var(--gold); padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .helper-title { font-size: 0.9rem; font-weight: bold; color: #B7791F; margin-bottom: 10px; }
        .btn-calc { background: var(--primary); color: white; border: none; padding: 0 15px; border-radius: 4px; cursor: pointer; font-size: 0.85rem; height: 46px; width: 100%; }

        /* --- Result --- */
        .result-box { background: #EBF5FB; border-left: 5px solid var(--primary); padding: 20px; border-radius: 4px; margin-top: 25px; }
        .result-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 1rem; border-bottom: 1px solid #D6EAF8; padding-bottom: 5px; align-items: center; }
        .result-val { font-weight: bold; color: var(--primary); font-family: 'Consolas', monospace; }
        .result-val.highlight { color: var(--accent-red); font-size: 1.4rem; }
        
        .luxury-warning { color: var(--accent-red); font-size: 0.9rem; margin-top: 15px; padding: 10px; background: #FFEBEE; border-radius: 4px; display: none; border: 1px solid #FFCDD2; }
        .luxury-calc-zone { display: none; background: #FFF5F5; border: 1px dashed #EF9A9A; padding: 15px; border-radius: 8px; margin-top: 15px; }

        /* --- Footer --- */
        .footer-copyright { text-align: center; color: #999; font-size: 0.8rem; margin-top: 30px; position: relative; z-index: 1; }
        .contact-bar { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-top: 15px; }
        .btn-contact { display: inline-flex; align-items: center; gap: 5px; padding: 10px 20px; border-radius: 50px; text-decoration: none; color: white; font-weight: bold; font-size: 0.9rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .btn-contact:hover { transform: translateY(-2px); }
        .btn-line { background: var(--line-green); }
        .btn-fb { background: var(--fb-blue); }
        .btn-google { background: #EA4335; }
        .btn-vip { background: var(--gold); }
        .btn-print { background: var(--text); }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* --- Mobile Print Optimization --- */
        @media print {
            /* å…è¨±åˆ—å°æ™‚é¸å–æ–‡å­— */
            * { -webkit-user-select: auto !important; user-select: auto !important; }
            
            /* éš±è—ä¸å¿…è¦çš„ä»‹é¢å…ƒç´  */
            .btn-contact, .tab-group, .btn-calc, #helperB, .helper-box button { display: none !important; }
            
            /* å¼·åˆ¶é¡¯ç¤ºæ‰€æœ‰å…§å®¹ï¼Œæˆ–åªé¡¯ç¤ºç•¶å‰ */
            body { background: white; padding: 0; font-size: 12pt; }
            .container { width: 100%; max-width: none; margin: 0; }
            .header { box-shadow: none; border: none; padding-bottom: 0; margin-bottom: 10px; }
            
            /* é—œéµä¿®æ­£ï¼šç¢ºä¿ç•¶å‰å¡ç‰‡å¯è¦‹ */
            .card { display: none; border: 1px solid #000; box-shadow: none; break-inside: avoid; margin-bottom: 20px; }
            .card.active { display: block !important; }
            
            /* æµ®æ°´å°èª¿æ•´ */
            .watermark-container { position: absolute; top: 200px; opacity: 0.05; }
            
            /* çµæœå€å¡Šæ¨£å¼ */
            .result-box { border: 1px solid #999; background: none; }
            .luxury-warning { border: 1px solid #000; background: none; color: #000; }
            
            /* ç¢ºä¿æ–‡å­—é¡è‰²ç‚ºæ·±è‰² */
            * { color: #000 !important; }
        }
    </style>
</head>
<body>

<div class="watermark-container">
    <img src="å®åœ‹åœ°æ”¿å°é¢.jpg" alt="å®åœ‹">
    <img src="æ˜“ä¸logo-01.jpg" alt="æ˜“ä¸">
</div>

<div class="header">
    <div class="logo-group">
        <img src="å®åœ‹åœ°æ”¿å°é¢.jpg" alt="å®åœ‹åœ°æ”¿">
        <img src="æ˜“ä¸logo-01.jpg" alt="æ˜“ä¸åœ°æ”¿">
    </div>
    <h1>å®åœ‹åœ°æ”¿ï½œæ˜“ä¸åœ°æ”¿</h1>
    <div class="subtitle">èˆŠåˆ¶è²¡ç”¢äº¤æ˜“æ‰€å¾—ç¨…ç²¾ç®—ç³»çµ± V21.6</div>
</div>

<div class="container">

    <div class="tab-group">
        <div class="tab active" onclick="switchTab('tab1')">æƒ…å¢ƒ Aï¼šæ¨™æº–èªå®š<br><span style="font-size:0.75rem">(101.08å‰ / è±ªå®…ç¨…)</span></div>
        <div class="tab" onclick="switchTab('tab2')">æƒ…å¢ƒ Bï¼šæ ¸å¯¦èªå®š<br><span style="font-size:0.75rem">(101.08å¾Œ / å»ºå•†äº¤æ˜“)</span></div>
    </div>

    <div id="tab1" class="card active">
        <div class="card-header">æƒ…å¢ƒ Aï¼šç„¡æ³•èˆ‰è­‰æˆæœ¬ (ä¾æ¨™æº–ç‡æˆ–è±ªå®…è¨ˆç®—)</div>

        <div class="helper-box">
            <div class="helper-title">ğŸ’¡ å¾ç¨…å–®åæ¨æˆ¿å±‹ç¾å€¼</div>
            <div class="input-row">
                <div class="input-col">
                    <label class="label">æˆ¿å±‹ç¨…å–®é‡‘é¡</label>
                    <input type="number" id="taxBill_A" placeholder="å…ƒ">
                </div>
                <div class="input-col">
                    <label class="label">ç¨…ç‡</label>
                    <select id="taxRate_A">
                        <option value="1.2">1.2% (ä½å®¶)</option>
                        <option value="1.5">1.5% (éä½éç‡Ÿ)</option>
                        <option value="3">3.0% (ç‡Ÿæ¥­)</option>
                    </select>
                </div>
                <div class="input-col" style="flex:0 0 60px;">
                    <button class="btn-calc" onclick="calcHouseVal('A')">åæ¨</button>
                </div>
            </div>
        </div>

        <div class="input-group">
            <label class="label">æˆ¿å±‹è©•å®šç¾å€¼ (å…ƒ)</label>
            <input type="number" id="houseVal_A" placeholder="è¼¸å…¥é‡‘é¡" oninput="calcA()">
        </div>

        <div class="input-row">
            <div class="input-col">
                <label class="label">äº¤æ˜“ç¸£å¸‚</label>
                <select id="city_A" onchange="updateDistricts('A'); calcA();">
                    <option value="">è«‹é¸æ“‡</option>
                    <option value="Taipei">è‡ºåŒ—å¸‚</option>
                    <option value="NewTaipei">æ–°åŒ—å¸‚</option>
                    <option value="Taoyuan">æ¡ƒåœ’å¸‚</option>
                    <option value="Taichung">è‡ºä¸­å¸‚</option>
                    <option value="Tainan">è‡ºå—å¸‚</option>
                    <option value="Kaohsiung">é«˜é›„å¸‚</option>
                    <option value="OtherCity">å…¶ä»–ç¸£å¸‚</option>
                </select>
            </div>
            <div class="input-col">
                <label class="label">è¡Œæ”¿å€</label>
                <select id="district_A" onchange="calcA()">
                    <option value="0">è«‹é¸æ“‡</option>
                </select>
            </div>
        </div>
        
        <div class="input-row">
            <div class="input-col">
                <label class="label">æˆ¿åœ°æˆäº¤ç¸½åƒ¹ (è¬)</label>
                <input type="number" id="totalPrice_A" placeholder="è±ªå®…åˆ¤æ–·ç”¨" oninput="calcA()">
            </div>
            <div class="input-col">
                <label class="label">å°ˆæœ‰åªæ•¸</label>
                <input type="number" id="areaPing_A" placeholder="ä¸å«è»Šä½" oninput="calcA()">
            </div>
        </div>

        <div id="luxuryMsg_A" class="luxury-warning">
            âš ï¸ <strong>å·²é”è±ªå®…é–€æª»ï¼</strong><br>
            <span id="luxuryReason_A"></span><br>
            è¨ˆç®—å…¬å¼è®Šæ›´ç‚ºï¼šæˆäº¤ç¸½åƒ¹ Ã— æˆ¿åœ°æ¯” Ã— 20%
        </div>

        <div id="luxuryZone_A" class="luxury-calc-zone">
            <span style="font-weight:bold; color:var(--accent-red); margin-bottom:10px; display:block;">ğŸ“ è±ªå®…ç¨…éœ€è¨ˆç®—æˆ¿åœ°æ¯”ï¼š</span>
            <div class="input-row">
                <div class="input-col">
                    <label class="label">åœŸåœ°å…¬å‘Šç¾å€¼ (å…ƒ/mÂ²)</label>
                    <input type="number" id="landPrice_A" oninput="calcA()">
                </div>
                <div class="input-col">
                    <label class="label">åœŸåœ°é¢ç© (mÂ²)</label>
                    <input type="number" id="landArea_A" oninput="calcA()">
                </div>
            </div>
            <div class="input-group">
                <label class="label">åœŸåœ°å…¬å‘Šç¾å€¼ç¸½é¡</label>
                <input type="number" id="totalLandVal_A" class="input-readonly" readonly>
            </div>
        </div>

        <div class="result-box">
            <div class="result-row">
                <span>è¨ˆç®—èªªæ˜ï¼š</span>
                <span class="result-val" id="calcMethod_A" style="font-size:0.9rem; font-weight:normal;">å°šæœªè¨ˆç®—</span>
            </div>
            <div class="result-row">
                <span>æ ¸å®šè²¡ç”¢äº¤æ˜“æ‰€å¾—ï¼š</span>
                <span class="result-val highlight" id="result_A">0 å…ƒ</span>
            </div>
        </div>
    </div>

    <div id="tab2" class="card">
        <div class="card-header">æƒ…å¢ƒ Bï¼šæ ¸å¯¦èªå®š (æœ‰æˆæœ¬è­‰æ˜)</div>

        <div class="input-row">
            <div class="input-col">
                <label class="label">è³£å‡ºç¸½é¡ (è¬)</label>
                <input type="number" id="sellPrice_B" oninput="calcB()">
            </div>
            <div class="input-col">
                <label class="label">è²·å…¥ç¸½é¡ (è¬)</label>
                <input type="number" id="buyPrice_B" oninput="calcB()">
            </div>
        </div>
        <div class="input-group">
            <label class="label">ç›¸é—œè²»ç”¨ (è¬) <span style="font-size:0.8rem; font-weight:normal;">(ä»²ä»‹/ä»£æ›¸/å¥‘ç¨…/è£ä¿®)</span></label>
            <input type="number" id="expenses_B" value="0" oninput="calcB()">
        </div>

        <div class="helper-box" style="border-color: var(--primary);">
            <div class="helper-title">ğŸ“ æˆ¿åœ°æ¯”è¨ˆç®—</div>
            
            <div class="input-row">
                <div class="input-col">
                    <label class="label">åœŸåœ°å…¬å‘Šç¾å€¼</label>
                    <input type="number" id="landPricePerSqm" oninput="calcLandValB()">
                </div>
                <div class="input-col">
                    <label class="label">åœŸåœ°é¢ç© (mÂ²)</label>
                    <input type="number" id="landAreaSqm" oninput="calcLandValB()">
                </div>
            </div>
            <div class="input-group">
                <label class="label">åœŸåœ°ç¾å€¼ç¸½é¡ (å…ƒ)</label>
                <input type="number" id="totalLandVal_B" class="input-readonly" readonly>
            </div>

            <div class="input-row">
                <div class="input-col">
                    <label class="label">æˆ¿å±‹è©•å®šç¾å€¼</label>
                    <input type="number" id="houseVal_B" oninput="calcB()">
                </div>
                <div class="input-col" style="flex:0 0 60px;">
                    <button class="btn-calc" onclick="calcHouseVal('B')">åæ¨</button>
                </div>
            </div>
            
            <div id="helperB" style="display:none; margin-top:10px;">
                 ç¨…å–® <input type="number" id="taxBill_B" style="width:70px"> Ã· ç¨…ç‡ <input type="number" id="taxRate_B" value="1.2" style="width:50px">% 
                 <button onclick="runHelperB()" style="padding:2px 5px;">ç¢ºèª</button>
            </div>
        </div>

        <div class="input-group">
            <label class="label">æˆ¿åœ°æ¯” (æˆ¿å±‹ä½”æ¯”)</label>
            <input type="text" id="houseRatio_B" class="input-readonly" readonly style="font-weight:bold; color:var(--primary);">
        </div>
        
        <div class="result-box">
            <div class="result-row">
                <span>æˆ¿åœ°ç¸½ç²åˆ©ï¼š</span>
                <span class="result-val" id="totalProfit_B">0 å…ƒ</span>
            </div>
            <div class="result-row" style="background:#FFF9C4;">
                <span>â˜… è²¡ç”¢äº¤æ˜“æ‰€å¾— (æ‡‰ç”³å ±)ï¼š</span>
                <span class="result-val highlight" id="finalIncome_B">0 å…ƒ</span>
            </div>
            <div style="font-size:0.8rem; color:#666; margin-top:5px;">
                *å…¬å¼ï¼š(è³£åƒ¹-è²·åƒ¹-è²»ç”¨) Ã— æˆ¿åœ°æ¯”
            </div>
        </div>
    </div>

    <div class="footer-copyright">
        <p>Copyright Â© å®åœ‹åœ°æ”¿ï½œæ˜“ä¸åœ°æ”¿å‡ºç‰ˆ All Rights Reserved.</p>
        <div class="contact-bar">
            <a href="https://line.me/R/ti/p/@604gpqef" target="_blank" class="btn-contact btn-line">
                <i>ğŸ’¬</i> å®˜æ–¹ LINE
            </a>
            <a href="https://maps.app.goo.gl/qyKhdrKsG5QBo2BW8" target="_blank" class="btn-contact btn-google">
                <i>ğŸ“</i> Google è©•è«–
            </a>
            <a href="https://www.facebook.com/062582589a/" target="_blank" class="btn-contact btn-fb">
                <i>f</i> FB ç²‰çµ²é 
            </a>
            <a href="https://line.me/ti/g2/aVklWxyLP1RtfstQsslGQOlP4KViuFI7PPucdQ?utm_source=invitation&utm_medium=link_copy&utm_campaign=default" target="_blank" class="btn-contact btn-vip">
                <i>ğŸ‘‘</i> VIP ç¤¾ç¾¤
            </a>
            <button onclick="window.print()" class="btn-contact btn-print">
                <i>ğŸ–¨ï¸</i> åˆ—å°å ±è¡¨
            </button>
        </div>
    </div>

</div>

<script>
    const taxData = {
        'Taipei': { 'luxury_price': 6000, 'luxury_unit': 120, 'districts': { 'ä¸­å±±å€': 48, 'æ¾å±±å€': 48, 'ä¸­æ­£å€': 48, 'å¤§å®‰å€': 48, 'ä¿¡ç¾©å€': 48, 'å£«æ—å€': 46, 'å…§æ¹–å€': 46, 'å¤§åŒå€': 46, 'å—æ¸¯å€': 46, 'åŒ—æŠ•å€': 45, 'è¬è¯å€': 45, 'æ–‡å±±å€': 45 } },
        'NewTaipei': { 'luxury_price': 4000, 'luxury_unit': 75, 'districts': { 'æ¿æ©‹å€': 44, 'æ°¸å’Œå€': 44, 'ä¸­å’Œå€': 44, 'ä¸‰é‡å€': 44, 'æ–°åº—å€': 44, 'è˜†æ´²å€': 44, 'æ–°èŠå€': 44, 'åœŸåŸå€': 44, 'æ—å£å€': 42, 'æ±æ­¢å€': 41, 'æ¨¹æ—å€': 41, 'æ³°å±±å€': 36, 'äº”è‚¡å€': 34, 'ä¸‰å³½å€': 34, 'æ·¡æ°´å€': 29, 'å…«é‡Œå€': 27, 'é¶¯æ­Œå€': 24, 'æ·±å‘å€': 23, 'å…¶ä»–': 14 } },
        'Taoyuan': { 'luxury_price': 3000, 'luxury_unit': 50, 'districts': { 'æ¡ƒåœ’å€': 33, 'ä¸­å£¢å€': 33, 'é¾œå±±å€': 32, 'è˜†ç«¹å€': 32, 'å…«å¾·å€': 32, 'å¹³é®å€': 26, 'å¤§åœ’å€': 24, 'é¾æ½­å€': 23, 'æ¥Šæ¢…å€': 23, 'æ–°å±‹å€': 18, 'è§€éŸ³å€': 16, 'å¾©èˆˆå€': 8 } },
        'Taichung': { 'luxury_price': 3000, 'luxury_unit': 50, 'districts': { 'è¥¿å±¯å€': 35, 'å—å±¯å€': 35, 'åŒ—å±¯å€': 32, 'è¥¿å€': 32, 'æ±å€': 30, 'å—å€': 30, 'åŒ—å€': 30, 'ä¸­å€': 26, 'çƒæ—¥å€': 24, 'å¤ªå¹³å€': 24, 'å¤§é‡Œå€': 24, 'æ½­å­å€': 22, 'è±åŸå€': 22, 'æ²™é¹¿å€': 22, 'å¤§é›…å€': 22, 'éœ§å³°å€': 21, 'å…¶ä»–': 15 } },
        'Tainan': { 'luxury_price': 3000, 'luxury_unit': 50, 'districts': { 'æ±å€': 30, 'å®‰å—å€': 28, 'ä¸­è¥¿å€': 28, 'åŒ—å€': 28, 'å®‰å¹³å€': 28, 'æ°¸åº·å€': 26, 'å—å€': 26, 'æ–°å¸‚å€': 24, 'å–„åŒ–å€': 23, 'å®‰å®šå€': 22, 'æ­¸ä»å€': 22, 'ä»å¾·å€': 22, 'æ–°ç‡Ÿå€': 20, 'å…¶ä»–': 10 } },
        'Kaohsiung': { 'luxury_price': 3000, 'luxury_unit': 50, 'districts': { 'å·¦ç‡Ÿå€': 37, 'é¼“å±±å€': 37, 'ä¸‰æ°‘å€': 37, 'è‹“é›…å€': 35, 'å‰é®å€': 35, 'å‰é‡‘å€': 34, 'æ¥ æ¢“å€': 33, 'å°æ¸¯å€': 33, 'æ–°èˆˆå€': 32, 'é³³å±±å€': 29, 'æ©‹é ­å€': 26, 'ä»æ­¦å€': 26, 'é¹½åŸ•å€': 26, 'å…¶ä»–': 15 } },
        'OtherCity': { 'luxury_price': 2200, 'luxury_unit': 35, 'districts': { 'æ–°ç«¹ç¸£å¸‚': 37, 'ä¸€èˆ¬ç¸£å¸‚': 18 } }
    };

    function switchTab(tabId) {
        document.querySelectorAll('.card').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function updateDistricts(type) {
        let city = document.getElementById('city_' + type).value;
        let distSelect = document.getElementById('district_' + type);
        distSelect.innerHTML = '<option value="0">è«‹é¸æ“‡å€åŸŸ</option>';
        if (taxData[city]) {
            for (let [dist, rate] of Object.entries(taxData[city].districts)) {
                let opt = document.createElement('option');
                opt.value = rate;
                opt.text = dist + ` (${rate}%)`;
                distSelect.add(opt);
            }
        }
    }

    function calcHouseVal(type) {
        if(type === 'B') { document.getElementById('helperB').style.display = 'block'; return; }
        let tax = parseFloat(document.getElementById('taxBill_' + type).value) || 0;
        let rate = parseFloat(document.getElementById('taxRate_' + type).value) || 0;
        if (rate > 0) {
            let val = Math.round(tax / (rate / 100));
            document.getElementById('houseVal_' + type).value = val;
            if(type === 'A') calcA();
        }
    }
    function runHelperB() {
        let tax = parseFloat(document.getElementById('taxBill_B').value) || 0;
        let rate = parseFloat(document.getElementById('taxRate_B').value) || 0;
        if (rate > 0) {
            let val = Math.round(tax / (rate / 100));
            document.getElementById('houseVal_B').value = val;
            document.getElementById('helperB').style.display = 'none';
            calcB();
        }
    }

    // --- æƒ…å¢ƒ A è¨ˆç®—é‚è¼¯ ---
    function calcA() {
        let houseVal = parseFloat(document.getElementById('houseVal_A').value) || 0;
        let distRate = parseFloat(document.getElementById('district_A').value) || 0;
        let totalPrice = parseFloat(document.getElementById('totalPrice_A').value) || 0;
        let areaPing = parseFloat(document.getElementById('areaPing_A').value) || 0;
        let city = document.getElementById('city_A').value;

        let isLuxury = false;
        let reason = "";

        if (city && taxData[city]) {
            let limitPrice = taxData[city].luxury_price;
            let limitUnit = taxData[city].luxury_unit;
            let unitPrice = (areaPing > 0) ? (totalPrice / areaPing) : 0;

            if (totalPrice >= limitPrice) {
                isLuxury = true;
                reason = `ç¸½åƒ¹ ${totalPrice}è¬ â‰§ ${limitPrice}è¬`;
            } else if (unitPrice >= limitUnit) {
                isLuxury = true;
                reason = `å–®åƒ¹ ${unitPrice.toFixed(1)}è¬ â‰§ ${limitUnit}è¬`;
            }
        }

        let luxuryZone = document.getElementById('luxuryZone_A');
        
        if (isLuxury) {
            // --- è±ªå®…æ¨¡å¼ ---
            luxuryZone.style.display = 'block';
            document.getElementById('luxuryMsg_A').style.display = 'block';
            document.getElementById('luxuryReason_A').innerText = reason;
            
            // éœ€è¼¸å…¥åœŸåœ°è³‡æ–™è¨ˆç®—æˆ¿åœ°æ¯”
            let landPrice = parseFloat(document.getElementById('landPrice_A').value) || 0;
            let landArea = parseFloat(document.getElementById('landArea_A').value) || 0;
            let totalLand = Math.round(landPrice * landArea);
            document.getElementById('totalLandVal_A').value = totalLand;

            let ratio = 0;
            if (houseVal + totalLand > 0) {
                ratio = houseVal / (houseVal + totalLand);
            }
            
            // å…¬å¼ï¼šæˆäº¤ç¸½åƒ¹ * æˆ¿åœ°æ¯” * 20%
            let totalPriceYuan = totalPrice * 10000;
            let houseIncome = totalPriceYuan * ratio;
            let income = Math.round(houseIncome * 0.20);
            
            document.getElementById('calcMethod_A').innerHTML = `è±ªå®…èªå®šï¼šæˆäº¤ç¸½åƒ¹ Ã— æˆ¿åœ°æ¯”${(ratio*100).toFixed(1)}% Ã— 20%`;
            document.getElementById('result_A').innerText = income.toLocaleString() + " å…ƒ";

        } else {
            // --- ä¸€èˆ¬æ¨¡å¼ ---
            luxuryZone.style.display = 'none';
            document.getElementById('luxuryMsg_A').style.display = 'none';
            
            let income = 0;
            if (distRate > 0) {
                income = Math.round(houseVal * (distRate / 100));
                document.getElementById('calcMethod_A').innerText = `æ¨™æº–ç‡æ³•ï¼šæˆ¿å±‹è©•å®šç¾å€¼ ${houseVal.toLocaleString()} Ã— ${distRate}%`;
            } else {
                document.getElementById('calcMethod_A').innerText = "è«‹é¸æ“‡ç¸£å¸‚èˆ‡è¡Œæ”¿å€";
            }
            
            document.getElementById('result_A').innerText = income.toLocaleString() + " å…ƒ";
        }
    }

    // --- æƒ…å¢ƒ B è¨ˆç®— ---
    function calcLandValB() {
        let price = parseFloat(document.getElementById('landPricePerSqm').value) || 0;
        let area = parseFloat(document.getElementById('landAreaSqm').value) || 0;
        let total = Math.round(price * area);
        document.getElementById('totalLandVal_B').value = total;
        calcB();
    }

    function calcB() {
        let buy = (parseFloat(document.getElementById('buyPrice_B').value) || 0) * 10000;
        let sell = (parseFloat(document.getElementById('sellPrice_B').value) || 0) * 10000;
        let exp = (parseFloat(document.getElementById('expenses_B').value) || 0) * 10000;
        
        let houseVal = parseFloat(document.getElementById('houseVal_B').value) || 0;
        let landVal = parseFloat(document.getElementById('totalLandVal_B').value) || 0;

        let totalAssessed = houseVal + landVal;
        let ratio = 0;
        if (totalAssessed > 0) {
            ratio = houseVal / totalAssessed;
        }
        document.getElementById('houseRatio_B').value = (ratio * 100).toFixed(2) + "%";

        let totalProfit = sell - buy - exp;
        document.getElementById('totalProfit_B').innerText = Math.round(totalProfit).toLocaleString() + " å…ƒ";

        let finalIncome = Math.round(totalProfit * ratio);
        if (finalIncome < 0) finalIncome = 0;
        document.getElementById('finalIncome_B').innerText = finalIncome.toLocaleString() + " å…ƒ";
    }
</script>

</body>
</html>